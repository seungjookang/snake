<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>지렁이 게임 (Snake)</title>
  <style>
    body{margin:0;background:#071428;display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;font-family:sans-serif;position:relative;}
    canvas{background:#081220;display:block;}
    .controls{position:absolute;bottom:20px;display:flex;gap:5px;z-index:5;}
    button{padding:10px;background:#10b981;border:none;border-radius:5px;color:#fff;cursor:pointer;}
    .touch-controls{display:none;position:absolute;bottom:50px;left:50%;transform:translateX(-50%);gap:5px;opacity:0.7;}
    .touch-controls button{width:50px;height:50px;font-size:20px;border-radius:8px;background:#10b981;opacity:0.7;color:#fff;border:none;}
    @media (max-width:720px){
      .touch-controls{display:flex;flex-direction:column;align-items:center;}
      .touch-controls .middle-row{display:flex;gap:5px;}
    }
  </style>
</head>
<body>
  <canvas id="game" width="720" height="540"></canvas>
  <div class="controls">
    <button onclick="startGame()">시작</button>
    <button onclick="pauseGame()">일시정지</button>
    <button onclick="resetGame()">재시작</button>
  </div>

  <div class="touch-controls" id="touchControls">
    <button id="upBtn">▲</button>
    <div class="middle-row">
      <button id="leftBtn">◀</button>
      <button id="downBtn">▼</button>
      <button id="rightBtn">▶</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const grid=20;
    let snake, dir, food, score, running=false;

    function resetGame(){
      snake=[{x:5,y:5}];
      dir={x:1,y:0};
      placeFood();
      score=0;
      running=false;
      draw();
    }

    function placeFood(){
      food={x:Math.floor(Math.random()*canvas.width/grid), y:Math.floor(Math.random()*canvas.height/grid)};
    }

    function draw(){
      ctx.fillStyle='#081220'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='#10b981'; snake.forEach(s=>ctx.fillRect(s.x*grid,s.y*grid,grid,grid));
      ctx.fillStyle='#facc15'; ctx.fillRect(food.x*grid,food.y*grid,grid,grid);
    }

    function step(){
      const head={x:snake[0].x+dir.x, y:snake[0].y+dir.y};
      snake.unshift(head);
      if(head.x===food.x && head.y===food.y){ score+=10; placeFood(); } else { snake.pop(); }
      draw();
    }

    function tick(){
      if(running){ step(); setTimeout(tick,100); }
    }

    function startGame(){ running=true; tick(); }
    function pauseGame(){ running=false; }

    document.addEventListener('keydown',e=>{
      if(e.key==='ArrowUp') dir={x:0,y:-1};
      if(e.key==='ArrowDown') dir={x:0,y:1};
      if(e.key==='ArrowLeft') dir={x:-1,y:0};
      if(e.key==='ArrowRight') dir={x:1,y:0};
    });

    resetGame();

    // 모바일 터치 버튼 이벤트
    const upBtn=document.getElementById('upBtn');
    const downBtn=document.getElementById('downBtn');
    const leftBtn=document.getElementById('leftBtn');
    const rightBtn=document.getElementById('rightBtn');

    upBtn.addEventListener('touchstart', e=>{ e.preventDefault(); dir={x:0,y:-1}; startGame(); });
    downBtn.addEventListener('touchstart', e=>{ e.preventDefault(); dir={x:0,y:1}; startGame(); });
    leftBtn.addEventListener('touchstart', e=>{ e.preventDefault(); dir={x:-1,y:0}; startGame(); });
    rightBtn.addEventListener('touchstart', e=>{ e.preventDefault(); dir={x:1,y:0}; startGame(); });
  </script>
</body>
</html>
